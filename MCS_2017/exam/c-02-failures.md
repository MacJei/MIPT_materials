## Типология отказов процессов, отказы сети. Вложенность классов отказов. Определение causal order (happens before) для AMP-систем.

### Классификация отказов.

Помним, что модель состоит из процессов и сети. Отказывать может и то, и то, то есть есть отказы процессов и отказы сети.

Значительная часть отказов сети обходятся так же, как отказы процессов. Мы это увидим позже, а пока забьем на них.

Пусть _f_ — некоторое число, тогда будем называть систему _f-failure tolerant_, если при отказе не более _f_ процессов система продолжает удовлетворять заявленным свойствам (нормально функционировать). Например, 5-failure-tolerant-системы работают при отказе до 5 процессов.

Отказы делятся на две большие группы.

* _Доброкачественные отказы (bening)_.

  * **Fail-Stop** — работал-работал процесс, делал какие-то свои важные действия, а потом что-то происходит, и он перестает работать. Но при этом все остальные процессы узнают о том, что он отказался (это детали реализации, механизм не важен). Например, пишем `ping ya.ru` и получаем ответ «извините, этот хост сломан».

  * **Crash** — то же самое, но нет механизма оповещения. Например, пишем `ping ya.ru`, и ничего не происходит. Мы не знаем, мы не дождались ответа или там все сломано.

  * **Omission** — целый спект отказов. По сути пропуск сообщений. Процесс _A_ отправляет процессу _B_ сообщение, отправил, а оно потерялось и не пришло. Или если процесс пришедшее сообщение прочитал, но обработать забыл и потерял. Соответственно, делится на Send Omission и Receive Omission. Например, пишем `ping ya.ru`, и часть пакетов не приходит.


* _Злокачественные отказы (malign)_.

  * **Byzantine** (византийский) — обычно понимается произвольное поведение, но как правило не совсем дурное (в этом случае сразу заметим: что-то не так) а как поведение злоумышленника, получившего контроль над одним из процессов и пытающегося навредить системе.

  Пример системы, пытающейся бороться с византийскими отказами — Bitcoin.

Наиболее частная форма отказов — византийская. Действительно, заметим, что Fail-Stop — частный Crash (при Crash можно сделать нотификацию, why not), Crash — частный случай Omission (теряем 100% сообщений), а Omission — частный случай Byzantine-отказов (произвольное поведение может включат и потерю сообщений).

Но если считать по самым глубоким классам, то, скорее, Omission или Crash.

Ясно, что проще всего бороться с Fail-Stop. А дальше сложнее и сложнее.

_Отказы для сети_.
* Получили ответ на вопрос, почему не смотрим на отказы сети: их можно смоделировать omission-отказами процессов.
* Уже сказали, что есть полная и частичная потеря связности.
* Византийские отказы: изменение сообщений, создание сообщений (никем не отправленных)

### Отношение happens before

Формальное определение AMP (Asynchronous Message Passing):
* система состоит из _n_ процессов _p_i_, расположенных на _n_ процессорах;
* _c_i,j_ — канал связи между процессами, _m_i,j_ — сообщение от процесса _p_i_ для процесса _p_j_; по сути канал связи ведет себя как множество, в котором лежат и из которого достаются сообщения;
* вычисления асинхронные, то есть процесс в случайный момент времени выполняет внутренний шаг алгоритма или проихводит отправку или получение сообщения;
* глобальных часов нет, отправка и получение сообщения не блокирующие;
* иногда моделируют честно, говоря, что какие-то каналы связи есть, а каких-то нет, а иногда не заморачиваются и считают граф полным; впрочем, если какого-то канала нет, то сообщение можно отправить через другие процессы, обеспечив тем самым логическую полную связность;
* выполнение процесса _p_i_ состоит из набора упорядоченных событий _e_i^x_;
* события бывают трех типов: `send`, `receive` или внутреннее событие;
* заданы три отношения порядка на множестве событий:
  * casual order — порядок событий внутри одного процесса (аналог из 4-го семестра — program order);
  * msg — `send(m)` всегда предшествует `receive(m)` (аналог из 4-го семестра — порядок на атомиках);
  * happens before — транзитивное замыкание этих двух отношений.

_Упражнение_: придумать определение wait-free для AMP-систем.
* _Решение_: вне зависимости от того, доходят твои сообщения другим процессам или нет, за константное время (число твоих собственных шагов) ты сделаешь что-то полезное (полезное — не получить или отправить сообщение (это лишь средство коммуникации), а, может, взять там лок какой-то или что-то такое).
