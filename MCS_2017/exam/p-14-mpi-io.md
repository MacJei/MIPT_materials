## Параллельный ввод-вывод в MPI. (Режимы работы, коллективные операции чтения и записи, понятие окна просмотра и др.)

Понятие MPI-IO появилось во втором стандарте MPI. Основная идея: есть файл, в который мы позволяем писать разным MPI-процессам через коммуникационную сеть. В произвольном вычислительном кластере есть узлы ввода-вывода на которых эти файлы хранятся. До этих узлов ввода-вывода данные нужно как-то доставить перед тем, как их записывать. Интерфейсы на уровне распределенных файловых систем это позволяют сделать. Но MPI-интерфейсы для работы с файлами обычно работают быстрее и дают больше гарантий на то, что записанные данные не будут перекрываться, затираться и т. д.

При работе с файлом в MPI создается абстракция View (окно просмотра), связывающая файл с процессом — почти что окно из концепции односторонних коммуникаций. Операции записи делаются абстракцией View атомарно. Каждому MPI-процессу отдается пространство во View. Когда процессы пишут, каждый из них пишет в свою область, тем самым гарантируя, что они не будут мешать друг другу, более того операции записи выполняются последовательно, с гарантией того, что не будет множественных операций произвольного доступа к жесткому диску.

Функции по работе с файлами.

* `int MPI_File_open(MPI_Comm comm, ROMIO_CONST char *filename, int amode,MPI_Info info, MPI_File *fh)` — открывает файл. Это коллективный вызов, должен быть исполнен всеми процессами коммуникатора. Каждый процесс получает на выходе свой `MPI_File`, с которым потом работает. Сразу после открытия каждый процесс видит файл как линейный поток байт.

* `int MPI_File_set_view(MPI_File fh, MPI_Offset disp, MPI_Datatype etype, MPI_Datatype filetype, const char *datarep, MPI_Info info)` — устанавливает View на файл. Здесь устанавливается тип данных для чтения или записи, позиция в файле, начиная с которой будет производиться чтение или запись и т. д.

* `int MPI_File_read(MPI_File fh, void *buf, int count, MPI_Datatype datatype, MPI_Status *status)` — чтение из файла.

* `int MPI_File_read_at(MPI_File fh, MPI_Offset offset, void *buf, int count, MPI_Datatype datatype, MPI_Status *status)` — чтение из файла с данным смещением.

* `int MPI_File_write(MPI_File fh, ROMIO_CONST void *buf, int count, MPI_Datatype datatype, MPI_Status *status)` — запись в файл.

* `int MPI_File_write_at(MPI_File fh, MPI_Offset offset, ROMIO_CONST void *buf, int count, MPI_Datatype datatype, MPI_Status *status)` — запись в файл с данным смещением.

Чтение при этом может производиться на другой машине и считанные результаты могут пересылаться через интерконнект, все зависит от устройства кластера. Чаще всего на кластере выделена отдельная сеть для хранилища данных, поэтому операции чтения и записи не будут мешать обычным коммуникациям посредством `MPI_Send` и `MPI_Recv`.
