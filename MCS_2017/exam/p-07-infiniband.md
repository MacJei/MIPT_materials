## Технология организации интерконнекта в вычислительном кластере InfiniBand. Основные принципы. Построение потоков данных между узлами кластера, маршрутизация, роль Subnet Manager.

InfiniBand является самой популярной технологией для организации интерконнекта. Высокая пропускная способность и низкая латентность. Одно из важных отличий от Ethernet — в InfiniBand накладываются очень жесткие требования на провода (длина ограничена). Кабели бывают медными и оптическими.

Принцип InfiniBand-протокола заключается в том, что соединение строится на время передачи одного пакета.

Перед тем, как что-то добавить в InfiniBand-сеть, производится исследование канала, соединяющего два узла: вычисляется пропускная способность для каждого конкретного провода и сохраняется в виде какого-то числа фишек на этом линке.

У каждого устройства есть GID (Global Identifier) и LID (Local Identirfier). Сетью управляет отдельно выделенное устройство Subnet Manager. При появлявлении нового устройство Subnet Manager (специальная машина) выдает ему LID, пересчитывает все таблицы пропускных способностей (фишки), которые нужно, пересчитывает таблицы маршрутизации и рассылает их тем, кому это нужно знать.

Одно из отличие от Ethernet заключается в том, что пакет не отправляется, если нельзя гарантировать, что он будет получен. Технически это условие проверяется так: сообщение какой-то длины стоит сколько-то фигек. Если фишек на переходе не достаточно, то переход не срабатывает. Если достаточно, то срабатывает, но из него отнимается требуемое количество фишек.

Кроме того, если замечено, что некоторый узел долго не отвечал на запросы, то говорят, что он умер, и удаляют из таблиц маршрутизации тех, кто с ним общался (Subnet Manager их перестраивает).

Поговорим теперь о возможностях RDMA (Remote Direct Memory Access). InfiniBand может писать данные напрямую в данных, не сообщая об этом процессору, не информируя об этом даже сами узлы и не влияя на скоорость выполнения на этом узле (так как минуем процессор). Это позволяет складывать пакету в чужую память и потом их использоваться. Также класть данные данные в узел и не дожидаться подтверждения (это называется односторонними коммуникациями, они поддерживаются, например, MPI 2.2).

Драйвер InifniBand резервирует область оперативной памяти, с которой потом оперирует, а общение происходит через какое-то API (не обязательно API соектов). Далее, в виртуальной памяти окно оторажает эти виртуальные адреса на ту область оперативной памяти через стандартный механизм ОС. Это можно осуществить через функции MPI.
